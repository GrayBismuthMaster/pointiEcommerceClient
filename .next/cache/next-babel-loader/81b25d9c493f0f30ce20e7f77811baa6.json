{"ast":null,"code":"import _toConsumableArray from \"D:/Programming/Trabajo/Javascript/MGRN/EcommercePointi/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"D:/Programming/Trabajo/Javascript/MGRN/EcommercePointi/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"D:/Programming/Trabajo/Javascript/MGRN/EcommercePointi/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"D:/Programming/Trabajo/Javascript/MGRN/EcommercePointi/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useMutation, useQuery, useSubscription } from '@apollo/client';\nimport { getAccessToken } from '../auth/auth';\nimport { ADD_MESSAGE_MUTATION, MESSAGES_QUERY, MESSAGE_ADDED_SUBSCRIPTION } from './queries';\nexport function useAddMessage() {\n  _s();\n\n  var _useMutation = useMutation(ADD_MESSAGE_MUTATION),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      mutate = _useMutation2[0];\n\n  return {\n    addMessage: function () {\n      var _addMessage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(text) {\n        var _yield$mutate, message;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return mutate({\n                  variables: {\n                    input: {\n                      text: text\n                    }\n                  },\n                  context: {\n                    headers: {\n                      'Authorization': 'Bearer ' + getAccessToken()\n                    }\n                  }\n                });\n\n              case 2:\n                _yield$mutate = _context.sent;\n                message = _yield$mutate.data.message;\n                return _context.abrupt(\"return\", message);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function addMessage(_x) {\n        return _addMessage.apply(this, arguments);\n      }\n\n      return addMessage;\n    }()\n  };\n}\n\n_s(useAddMessage, \"grlonYozFypkfP0s7vTF79Oo2Ls=\", false, function () {\n  return [useMutation];\n});\n\nexport function useMessages() {\n  _s2();\n\n  var _data$messages;\n\n  var _useQuery = useQuery(MESSAGES_QUERY, {\n    context: {\n      headers: {\n        'Authorization': 'Bearer ' + getAccessToken()\n      }\n    }\n  }),\n      data = _useQuery.data;\n\n  useSubscription(MESSAGE_ADDED_SUBSCRIPTION, {\n    onSubscriptionData: function onSubscriptionData(_ref) {\n      var client = _ref.client,\n          subscriptionData = _ref.subscriptionData;\n      console.log(\"Mensajes obtenidos desde el server\", subscriptionData.data.message);\n      console.log(client);\n      var message = subscriptionData.data.message;\n      client.cache.updateQuery({\n        query: MESSAGES_QUERY\n      }, function (_ref2) {\n        var messages = _ref2.messages;\n        return {\n          messages: [].concat(_toConsumableArray(messages), [message])\n        };\n      });\n    }\n  }); // console.log(\"subscription\", subscription);\n\n  return {\n    messages: (_data$messages = data === null || data === void 0 ? void 0 : data.messages) !== null && _data$messages !== void 0 ? _data$messages : []\n  };\n}\n\n_s2(useMessages, \"UL22zZoRKxYSA93eaLmyouG8eOE=\", false, function () {\n  return [useQuery, useSubscription];\n});","map":{"version":3,"sources":["D:/Programming/Trabajo/Javascript/MGRN/EcommercePointi/client/graphql/hooks.js"],"names":["useMutation","useQuery","useSubscription","getAccessToken","ADD_MESSAGE_MUTATION","MESSAGES_QUERY","MESSAGE_ADDED_SUBSCRIPTION","useAddMessage","mutate","addMessage","text","variables","input","context","headers","message","data","useMessages","onSubscriptionData","client","subscriptionData","console","log","cache","updateQuery","query","messages"],"mappings":";;;;;;;;AAAA,SAASA,WAAT,EAAsBC,QAAtB,EAAgCC,eAAhC,QAAuD,gBAAvD;AACA,SAASC,cAAT,QAA+B,cAA/B;AACA,SAASC,oBAAT,EAA+BC,cAA/B,EAA+CC,0BAA/C,QAAiF,WAAjF;AAEA,OAAO,SAASC,aAAT,GAAyB;AAAA;;AAAA,qBAEbP,WAAW,CAACI,oBAAD,CAFE;AAAA;AAAA,MAEvBI,MAFuB;;AAI9B,SAAO;AACLC,IAAAA,UAAU;AAAA,iFAAE,iBAAOC,IAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAC0BF,MAAM,CAAC;AACzCG,kBAAAA,SAAS,EAAE;AAAEC,oBAAAA,KAAK,EAAE;AAAEF,sBAAAA,IAAI,EAAJA;AAAF;AAAT,mBAD8B;AAEzCG,kBAAAA,OAAO,EAAE;AACPC,oBAAAA,OAAO,EAAE;AAAE,uCAAiB,YAAYX,cAAc;AAA7C;AADF;AAFgC,iBAAD,CADhC;;AAAA;AAAA;AACMY,gBAAAA,OADN,iBACFC,IADE,CACMD,OADN;AAAA,iDAOHA,OAPG;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA;AADL,GAAP;AAWD;;GAfeR,a;UAEGP,W;;;AAenB,OAAO,SAASiB,WAAT,GAAuB;AAAA;;AAAA;;AAAA,kBAIXhB,QAAQ,CAACI,cAAD,EAAiB;AACxCQ,IAAAA,OAAO,EAAE;AACPC,MAAAA,OAAO,EAAE;AAAE,yBAAiB,YAAYX,cAAc;AAA7C;AADF;AAD+B,GAAjB,CAJG;AAAA,MAIpBa,IAJoB,aAIpBA,IAJoB;;AAU5Bd,EAAAA,eAAe,CAACI,0BAAD,EAA6B;AAE1CY,IAAAA,kBAAkB,EAAE,kCAAkC;AAAA,UAA/BC,MAA+B,QAA/BA,MAA+B;AAAA,UAAvBC,gBAAuB,QAAvBA,gBAAuB;AACpDC,MAAAA,OAAO,CAACC,GAAR,CAAY,oCAAZ,EAAkDF,gBAAgB,CAACJ,IAAjB,CAAsBD,OAAxE;AACAM,MAAAA,OAAO,CAACC,GAAR,CAAYH,MAAZ;AAEA,UAAMJ,OAAO,GAAGK,gBAAgB,CAACJ,IAAjB,CAAsBD,OAAtC;AACAI,MAAAA,MAAM,CAACI,KAAP,CAAaC,WAAb,CAAyB;AAAEC,QAAAA,KAAK,EAAEpB;AAAT,OAAzB,EAAoD,iBAAkB;AAAA,YAAfqB,QAAe,SAAfA,QAAe;AACpE,eAAO;AAAEA,UAAAA,QAAQ,+BAAMA,QAAN,IAAgBX,OAAhB;AAAV,SAAP;AACD,OAFD;AAGD;AAVyC,GAA7B,CAAf,CAV4B,CAsB5B;;AACA,SAAO;AACLW,IAAAA,QAAQ,oBAAEV,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEU,QAAR,2DAAoB;AADvB,GAAP;AAGD;;IA1BeT,W;UAIGhB,Q,EAMjBC,e","sourcesContent":["import { useMutation, useQuery, useSubscription } from '@apollo/client';\r\nimport { getAccessToken } from '../auth/auth';\r\nimport { ADD_MESSAGE_MUTATION, MESSAGES_QUERY, MESSAGE_ADDED_SUBSCRIPTION } from './queries';\r\n\r\nexport function useAddMessage() {\r\n\r\n  const [mutate] = useMutation(ADD_MESSAGE_MUTATION);\r\n\r\n  return {\r\n    addMessage: async (text) => {\r\n      const { data: { message } } = await mutate({\r\n        variables: { input: { text } },\r\n        context: {\r\n          headers: { 'Authorization': 'Bearer ' + getAccessToken() },\r\n        },\r\n      });\r\n      return message;\r\n    },\r\n  };\r\n}\r\n\r\nexport function useMessages() {\r\n\r\n\r\n\r\n  const { data } = useQuery(MESSAGES_QUERY, {\r\n    context: {\r\n      headers: { 'Authorization': 'Bearer ' + getAccessToken() },\r\n    },\r\n  });\r\n  \r\n  useSubscription(MESSAGE_ADDED_SUBSCRIPTION, {\r\n    \r\n    onSubscriptionData: ({ client, subscriptionData }) => {\r\n      console.log(\"Mensajes obtenidos desde el server\", subscriptionData.data.message);\r\n      console.log(client);\r\n\r\n      const message = subscriptionData.data.message;\r\n      client.cache.updateQuery({ query: MESSAGES_QUERY }, ({ messages }) => {\r\n        return { messages: [...messages, message] };\r\n      });\r\n    },\r\n  });\r\n  // console.log(\"subscription\", subscription);\r\n  return {\r\n    messages: data?.messages ?? [],\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}