{"ast":null,"code":"import _regeneratorRuntime from \"D:/Programming/Trabajo/MGRN/EcommercePointi/client/node_modules/@babel/runtime/regenerator\";\nimport _objectWithoutProperties from \"D:/Programming/Trabajo/MGRN/EcommercePointi/client/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _asyncToGenerator from \"D:/Programming/Trabajo/MGRN/EcommercePointi/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"D:/Programming/Trabajo/MGRN/EcommercePointi/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"D:/Programming/Trabajo/MGRN/EcommercePointi/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"D:/Programming/Trabajo/MGRN/EcommercePointi/client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\Programming\\\\Trabajo\\\\MGRN\\\\EcommercePointi\\\\client\\\\pages\\\\nuevopedido.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    query obtenerPedidosVendedor{\\n        obtenerPedidosVendedor{\\n            id\\n            pedido{\\n                id\\n                nombre\\n                cantidad\\n            }\\n            cliente{\\n                id\\n                nombre\\n                apellido\\n                email\\n                telefono\\n            }\\n            vendedor\\n            total\\n            estado\\n        }\\n    }\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    mutation nuevoPedido($input : PedidoInput){\\n      nuevoPedido(input : $input){\\n        id\\n      }\\n    }    \\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useContext, useState } from 'react';\nimport Layout from '../components/Layout';\nimport AsignarCliente from '../components/pedidos/AsignarCliente';\nimport AsignarProductos from '../components/pedidos/AsignarProductos';\nimport ResumenPedido from '../components/pedidos/ResumenPedido';\nimport Total from '../components/pedidos/Total';\nimport { gql, useMutation } from '@apollo/client';\nimport { useRouter } from 'next/router';\nimport Swal from 'sweetalert2'; //Context de Pedidos\n\nimport PedidoContext from '../context/pedidos/PedidoContext';\nvar NUEVO_PEDIDO = gql(_templateObject());\nvar OBTENER_PEDIDOS = gql(_templateObject2());\n\nvar NuevoPedido = function NuevoPedido() {\n  _s();\n\n  var router = useRouter();\n\n  var _useState = useState(null),\n      mensaje = _useState[0],\n      setMensaje = _useState[1]; //Utilizar context y extraer sus funciones\n\n\n  var pedidoContext = useContext(PedidoContext); // console.log(pedidoContext);\n  // const {holaMundoEnUseReducer} = pedidoContext\n  // holaMundoEnUseReducer();\n\n  var cliente = pedidoContext.cliente,\n      productos = pedidoContext.productos,\n      total = pedidoContext.total;\n  var id = cliente.id; //Mutation para nuevo Pedido\n\n  var _useMutation = useMutation(NUEVO_PEDIDO, {\n    update: function update(cache, _ref) {\n      var nuevoPedido = _ref.data.nuevoPedido;\n\n      var _cache$readQuery = cache.readQuery({\n        query: OBTENER_PEDIDOS\n      }),\n          obtenerPedidosVendedor = _cache$readQuery.obtenerPedidosVendedor;\n\n      cache.writeQuery({\n        query: OBTENER_PEDIDOS,\n        data: {\n          obtenerPedidosVendedor: [].concat(_toConsumableArray(obtenerPedidosVendedor), [nuevoPedido])\n        }\n      });\n    }\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      nuevoPedido = _useMutation2[0];\n\n  var validarPedido = function validarPedido() {\n    return !productos.every(function (producto) {\n      return producto.cantidad > 0;\n    }) || total === 0 || cliente.length === 0 ? \" opacity-50 cursor-not-allowed\" : \"\";\n  };\n\n  var crearNuevoPedido = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var pedido, _yield$nuevoPedido, data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              //Remover atributos que no van \n              pedido = productos.map(function (_ref3) {\n                var existencia = _ref3.existencia,\n                    __typename = _ref3.__typename,\n                    producto = _objectWithoutProperties(_ref3, [\"existencia\", \"__typename\"]);\n\n                return producto;\n              });\n              _context.prev = 1;\n              _context.next = 4;\n              return nuevoPedido({\n                variables: {\n                  input: {\n                    cliente: id,\n                    total: total,\n                    pedido: pedido\n                  }\n                }\n              });\n\n            case 4:\n              _yield$nuevoPedido = _context.sent;\n              data = _yield$nuevoPedido.data;\n              //redireccionar\n              router.push('/pedidos');\n              Swal.fire(\"Correcto\", \"El pedido se registr√≥ correctamente\", \"success\");\n              _context.next = 14;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](1);\n              setMensaje(_context.t0.message.replace('Error : ', ''));\n              setTimeout(function () {\n                setMensaje(null);\n              }, 3000);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 10]]);\n    }));\n\n    return function crearNuevoPedido() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var mostrarMensaje = function mostrarMensaje() {\n    return __jsx(\"div\", {\n      className: \"bg-white py-2 px-3 w-full my-3 max-w-sm text-center mx-auto\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 7\n      }\n    }, __jsx(\"p\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }\n    }, mensaje));\n  };\n\n  return __jsx(Layout, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 5\n    }\n  }, __jsx(\"h1\", {\n    className: \"text-2xl text-gray-800 font-light\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }\n  }), mensaje && mostrarMensaje(), __jsx(\"div\", {\n    className: \"flex justify-center mt-5\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"w-full max-w-lg\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 11\n    }\n  }, __jsx(AsignarCliente, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }\n  }), __jsx(AsignarProductos, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 13\n    }\n  }), __jsx(ResumenPedido, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 13\n    }\n  }), __jsx(Total, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }\n  }), __jsx(\"button\", {\n    type: \"button\",\n    className: \"bg-gray-800 w-full mt-5 p-2 text-white uppercase font-bold hover:bg-gray-700 \".concat(validarPedido()),\n    onClick: crearNuevoPedido,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }\n  }, \"Registrar Pedido\"))));\n};\n\n_s(NuevoPedido, \"UFFSRUURKYHSFuSXcox/MkhbFqw=\", false, function () {\n  return [useRouter, useMutation];\n});\n\n_c = NuevoPedido;\nexport default NuevoPedido;\n\nvar _c;\n\n$RefreshReg$(_c, \"NuevoPedido\");","map":{"version":3,"sources":["D:/Programming/Trabajo/MGRN/EcommercePointi/client/pages/nuevopedido.js"],"names":["React","useContext","useState","Layout","AsignarCliente","AsignarProductos","ResumenPedido","Total","gql","useMutation","useRouter","Swal","PedidoContext","NUEVO_PEDIDO","OBTENER_PEDIDOS","NuevoPedido","router","mensaje","setMensaje","pedidoContext","cliente","productos","total","id","update","cache","nuevoPedido","data","readQuery","query","obtenerPedidosVendedor","writeQuery","validarPedido","every","producto","cantidad","length","crearNuevoPedido","pedido","map","existencia","__typename","variables","input","push","fire","message","replace","setTimeout","mostrarMensaje"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from 'react'\r\nimport Layout from '../components/Layout'\r\nimport AsignarCliente from '../components/pedidos/AsignarCliente'\r\nimport AsignarProductos from '../components/pedidos/AsignarProductos'\r\nimport ResumenPedido from '../components/pedidos/ResumenPedido'\r\nimport Total from '../components/pedidos/Total'\r\nimport {gql, useMutation} from '@apollo/client'\r\nimport {useRouter } from 'next/router'\r\nimport Swal from 'sweetalert2'\r\n//Context de Pedidos\r\nimport PedidoContext from '../context/pedidos/PedidoContext'\r\n\r\nconst NUEVO_PEDIDO = gql`\r\n    mutation nuevoPedido($input : PedidoInput){\r\n      nuevoPedido(input : $input){\r\n        id\r\n      }\r\n    }    \r\n`\r\nconst OBTENER_PEDIDOS = gql`\r\n    query obtenerPedidosVendedor{\r\n        obtenerPedidosVendedor{\r\n            id\r\n            pedido{\r\n                id\r\n                nombre\r\n                cantidad\r\n            }\r\n            cliente{\r\n                id\r\n                nombre\r\n                apellido\r\n                email\r\n                telefono\r\n            }\r\n            vendedor\r\n            total\r\n            estado\r\n        }\r\n    }\r\n`\r\nconst NuevoPedido = () => {\r\n  const router = useRouter();\r\n  const [mensaje, setMensaje] = useState(null);\r\n  //Utilizar context y extraer sus funciones\r\n  const pedidoContext = useContext(PedidoContext);\r\n  // console.log(pedidoContext);\r\n  // const {holaMundoEnUseReducer} = pedidoContext\r\n  // holaMundoEnUseReducer();\r\n  const {cliente, productos, total} = pedidoContext;\r\n \r\n  const { id} = cliente;\r\n\r\n  //Mutation para nuevo Pedido\r\n  const [nuevoPedido] = useMutation(NUEVO_PEDIDO, {\r\n    update(cache, {data : {nuevoPedido}}){\r\n      const {obtenerPedidosVendedor} = cache.readQuery({\r\n        query : OBTENER_PEDIDOS\r\n      }) ;\r\n      cache.writeQuery({\r\n        query: OBTENER_PEDIDOS, \r\n        data : {\r\n          obtenerPedidosVendedor : [...obtenerPedidosVendedor, nuevoPedido]\r\n        }\r\n      })\r\n    }\r\n  });\r\n\r\n  const validarPedido = () => {\r\n    return !productos.every(producto => producto.cantidad > 0 ) || total === 0 || cliente.length === 0? \" opacity-50 cursor-not-allowed\" :\"\" ;\r\n  }\r\n  const crearNuevoPedido = async ()=>{\r\n    //Remover atributos que no van \r\n    const pedido = productos.map(({existencia,__typename, ...producto})=>producto)\r\n    try{\r\n      const {data} = await nuevoPedido({\r\n        variables : {\r\n          input : {\r\n            cliente : id,\r\n            total, \r\n            pedido\r\n          }\r\n        }\r\n      })\r\n      //redireccionar\r\n      router.push('/pedidos')\r\n      Swal.fire(\r\n        \"Correcto\",\r\n        \"El pedido se registr√≥ correctamente\", \r\n        \"success\"\r\n      )\r\n    }catch(error){\r\n      setMensaje(error.message.replace('Error : ', ''))\r\n      setTimeout(() => {\r\n        setMensaje(null);\r\n      }, 3000);\r\n    }\r\n  }\r\n  const mostrarMensaje = ()=>{\r\n    return (\r\n      <div className='bg-white py-2 px-3 w-full my-3 max-w-sm text-center mx-auto'>\r\n        <p>{mensaje}</p>\r\n      </div>\r\n    )\r\n  }\r\n  return (\r\n    <Layout>\r\n        <h1 className='text-2xl text-gray-800 font-light'></h1>\r\n        {mensaje && mostrarMensaje()}\r\n        <div className='flex justify-center mt-5'>\r\n          <div className='w-full max-w-lg'>\r\n            <AsignarCliente/>\r\n            <AsignarProductos/> \r\n            <ResumenPedido/>\r\n            <Total/>\r\n            <button\r\n              type='button'\r\n              className={`bg-gray-800 w-full mt-5 p-2 text-white uppercase font-bold hover:bg-gray-700 ${validarPedido()}`}\r\n              onClick = {crearNuevoPedido}\r\n            >\r\n              Registrar Pedido\r\n            </button>\r\n          </div>\r\n        </div>\r\n    </Layout>\r\n  )\r\n}\r\n\r\nexport default NuevoPedido"]},"metadata":{},"sourceType":"module"}