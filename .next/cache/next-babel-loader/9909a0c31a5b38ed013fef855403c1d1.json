{"ast":null,"code":"import _regeneratorRuntime from \"D:/Programming/Trabajo/MGRN/EcommercePointi/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"D:/Programming/Trabajo/MGRN/EcommercePointi/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport jwtDecode from 'jwt-decode';\nvar ACCESS_TOKEN_KEY = 'token';\nvar API_URL = 'http://localhost:9000';\nvar ISSERVER = false;\nexport function getAccessToken() {\n  if (!ISSERVER) {\n    return localStorage.getItem(ACCESS_TOKEN_KEY);\n  }\n}\nexport function getUser() {\n  if (!ISSERVER) {\n    var token = getAccessToken();\n    console.log(\"desde el getUser\", token);\n\n    if (!token) {\n      return null;\n    }\n\n    return getUserFromToken(token);\n  }\n}\nexport function login(_x, _x2) {\n  return _login.apply(this, arguments);\n}\n\nfunction _login() {\n  _login = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(userId, password) {\n    var response, _yield$response$json, token;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return fetch(\"\".concat(API_URL, \"/login\"), {\n              method: 'POST',\n              headers: {\n                'content-type': 'application/json'\n              },\n              body: JSON.stringify({\n                userId: userId,\n                password: password\n              })\n            });\n\n          case 2:\n            response = _context.sent;\n\n            if (!response.ok) {\n              _context.next = 11;\n              break;\n            }\n\n            _context.next = 6;\n            return response.json();\n\n          case 6:\n            _yield$response$json = _context.sent;\n            token = _yield$response$json.token;\n            _context.next = 10;\n            return localStorage.setItem(ACCESS_TOKEN_KEY, token);\n\n          case 10:\n            return _context.abrupt(\"return\", {\n              id: userId\n            });\n\n          case 11:\n            return _context.abrupt(\"return\", null);\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _login.apply(this, arguments);\n}\n\nexport function logout() {\n  localStorage.removeItem(ACCESS_TOKEN_KEY);\n}\n\nfunction getUserFromToken(token) {\n  if (!ISSERVER) {\n    console.log(\"desde el getUserFromToken\", token);\n    var jwtPayload = jwtDecode(token);\n    console.log(jwtPayload.sub);\n    return {\n      usuario: {\n        id: jwtPayload.sub\n      }\n    };\n  }\n}","map":null,"metadata":{},"sourceType":"module"}